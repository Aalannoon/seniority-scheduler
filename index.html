<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seniority Scheduler</title>

<style>
body { font-family: Arial; background:#f5f5f5; padding:20px; }
.section { background:#fff; padding:15px; border-radius:6px; margin-bottom:20px; }
input,select,button { padding:6px; margin:4px 0; }
table { border-collapse:collapse; width:100%; margin-top:15px; }
th,td { border:1px solid #ccc; padding:6px; text-align:center; }
th { background:#eee; }
.employee-row { font-weight:bold; }

.shift-4 { background:#c8f7c5; }
.shift-6 { background:#ffd59e; }
.shift-8 { background:#fff3a0; }
.shift-ot { background:#d5b3ff; }

.vacation { background:#ddd; color:#666; font-style:italic; }
</style>
</head>

<body>

<h1>Seniority Scheduler</h1>

<div class="section">
<h2>Add Employee</h2>
<input id="empName" placeholder="Name">
<select id="empType">
  <option value="full">Full-Time</option>
  <option value="part">Part-Time</option>
</select>
<select id="empPref">
  <option value="morning">Morning</option>
  <option value="midday">Midday</option>
  <option value="night">Afternoon / Night</option>
</select>
<button onclick="addEmployee()">Add Employee</button>
<ul id="employeeList"></ul>
</div>

<div class="section">
<h2>Employee Vacation</h2>
<select id="vacEmp"></select><br>
From <input type="date" id="vacStart">
To <input type="date" id="vacEnd">
<button onclick="addVacation()">Add Vacation</button>
</div>

<div class="section">
<h2>Add Event</h2>
<input type="date" id="eventDate">
<input type="time" id="eventStart">
<input type="time" id="eventEnd">
<input type="number" id="eventGuests" placeholder="Guests">
<button onclick="addEvent()">Add Event</button>
<ul id="eventList"></ul>
</div>

<div class="section">
<button onclick="generateSchedule()">Generate Schedule</button>
</div>

<div class="section">
<h2 id="scheduleHeader"></h2>
<div id="schedule"></div>
</div>

<script>
let employees = JSON.parse(localStorage.getItem("employees")) || [];
let events = JSON.parse(localStorage.getItem("events")) || [];

function save(){
  localStorage.setItem("employees",JSON.stringify(employees));
  localStorage.setItem("events",JSON.stringify(events));
}

function normalizeSeniority(){
  const full = employees.filter(e=>e.type==="full");
  const part = employees.filter(e=>e.type==="part");

  full.sort((a,b)=>a.seniority-b.seniority);
  part.sort((a,b)=>a.seniority-b.seniority);

  full.forEach((e,i)=>e.seniority=i+1);
  part.forEach((e,i)=>e.seniority=full.length+i+1);

  employees=[...full,...part];
}

function addEmployee(){
  if(!empName.value) return alert("Name required");

  const seniority = employees.length + 1;

  employees.push({
    name: empName.value,
    type: empType.value,
    pref: empPref.value,
    seniority,
    vacations: []
  });

  normalizeSeniority();
  empName.value="";
  save();
  renderEmployees();
}

function retireEmployee(index){
  if(!confirm("Retire this employee?")) return;
  employees.splice(index,1);
  normalizeSeniority();
  save();
  renderEmployees();
}

function renderEmployees(){
  employeeList.innerHTML="";
  vacEmp.innerHTML="";

  employees.forEach((e,i)=>{
    employeeList.innerHTML += `
      <li>
        #${e.seniority} ${e.name}
        (${e.type}, ${e.pref})
        <button onclick="retireEmployee(${i})">Retire</button>
      </li>`;
    vacEmp.innerHTML += `<option>${e.name}</option>`;
  });
}

function addVacation(){
  const e=employees.find(x=>x.name===vacEmp.value);
  if(!e||!vacStart.value||!vacEnd.value) return;
  e.vacations.push({start:vacStart.value,end:vacEnd.value});
  save();
  alert("Vacation added");
}

function addEvent(){
  events.push({
    date:eventDate.value,
    start:eventStart.value,
    end:eventEnd.value,
    guests:Number(eventGuests.value||0)
  });
  save();
  renderEvents();
}

function renderEvents(){
  eventList.innerHTML="";
  events.forEach((e,i)=>{
    eventList.innerHTML+=`
      <li>
        ${e.date} ${e.start}-${e.end} (${e.guests})
        <button onclick="events.splice(${i},1);save();renderEvents()">‚ùå</button>
      </li>`;
  });
}

function isOnVacation(emp,d){
  return emp.vacations.some(v=>d>=v.start&&d<=v.end);
}

function recommendServers(g){
  if(g<=50) return 2;
  if(g<=150) return 4;
  if(g<=300) return 6;
  return 8;
}

function prefScore(pref,start){
  const h=parseInt(start.split(":")[0]);
  if(pref==="morning") return h<12?0:1;
  if(pref==="midday") return h>=11&&h<=15?0:1;
  return h>=15?0:1;
}

function generateSchedule(){
  let sched={};

  const sorted=[...employees].sort((a,b)=>a.seniority-b.seniority);

  events.forEach(ev=>{
    const start=new Date(ev.date+"T"+ev.start);
    const end=new Date(ev.date+"T"+ev.end);

    let paid=Math.max(4,Math.min(8,(end-start)/3600000));
    let schedH=paid>4?paid+0.5:paid;
    let need=recommendServers(ev.guests);

    let candidates=sorted
      .filter(e=>!isOnVacation(e,ev.date))
      .sort((a,b)=>prefScore(a.pref,ev.start)-prefScore(b.pref,ev.start));

    let used=0;
    candidates.forEach(emp=>{
      if(used>=need) return;
      if(!sched[emp.name]) sched[emp.name]={};
      if(sched[emp.name][ev.date]) return;

      sched[emp.name][ev.date]={start:ev.start,end:ev.end,paid,schedH};
      used++;
    });
  });

  renderSchedule(sched);
}

function getWeek(){
  const t=new Date();
  const m=new Date(t);
  m.setDate(t.getDate()-((t.getDay()+6)%7));
  return [...Array(7)].map((_,i)=>{
    const d=new Date(m); d.setDate(m.getDate()+i);
    return d.toISOString().split("T")[0];
  });
}

function shiftClass(p){
  if(p>=8) return "shift-8";
  if(p>=6) return "shift-6";
  return "shift-4";
}

function renderSchedule(s){
  const week=getWeek();
  const head=new Date(week[0]);
  scheduleHeader.textContent=head.toLocaleString("default",{month:"long",year:"numeric"});

  let html="<table><tr><th>Employee</th>";
  week.forEach(d=>{
    const dt=new Date(d);
    html+=`<th>${dt.toLocaleDateString("default",{weekday:"short"})} ${dt.getDate()}</th>`;
  });
  html+="</tr>";

  employees.forEach(emp=>{
    html+=`<tr><td class="employee-row">#${emp.seniority} ${emp.name}</td>`;
    week.forEach(d=>{
      if(isOnVacation(emp,d)){
        html+=`<td class="vacation">Vacation</td>`;
      } else if(s?.[emp.name]?.[d]){
        const sh=s[emp.name][d];
        html+=`<td class="${shiftClass(sh.paid)}">
          ${sh.start}-${sh.end}<br>${sh.schedH}h
        </td>`;
      } else html+="<td></td>";
    });
    html+="</tr>";
  });

  schedule.innerHTML=html+"</table>";
}

renderEmployees();
renderEvents();
</script>

</body>
</html>

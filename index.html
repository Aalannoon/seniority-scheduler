<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Seniority Scheduler Dashboard</title>

<style>
body {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  margin: 20px;
  background: #1e1e2f;
  color: #f0f0f0;
  transition: background 0.3s, color 0.3s;
}
body.light-mode { background:#f8f9fa; color:#333; }

h1 { font-size:28px; margin-bottom:10px; }
h2 { margin-top:20px; margin-bottom:10px; }

/* TABS */
.tabs { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:12px; }
.tabs button {
  padding:8px 14px;
  cursor:pointer;
  border:none;
  border-radius:8px;
  font-weight:bold;
  transition:0.2s;
}
.tabs button.active { background:#4e9af1; color:#fff; }
body.dark-mode .tabs button { background:#2e2e3d; color:#ccc; }
body.dark-mode .tabs button.active { background:#4e9af1; color:#fff; }

/* INPUTS & BUTTONS */
input, select, button {
  margin-right:6px;
  margin-bottom:6px;
  padding:6px 10px;
  border-radius:6px;
  border:none;
  font-size:14px;
}
button {
  font-weight:bold;
  background:#4e9af1;
  color:#fff;
  transition:0.2s;
}
button:hover { opacity:0.85; transform: translateY(-2px); }
body.light-mode button { background:#007bff; color:#fff; }

/* TABLES */
table {
  border-collapse:collapse;
  width:100%;
  margin-top:10px;
  border-radius:8px;
  overflow:hidden;
  box-shadow:0 2px 8px rgba(0,0,0,0.3);
  table-layout: fixed;
}
th, td {
  padding:10px;
  text-align:center;
  border-bottom:1px solid #444;
}
th {
  background:#4e9af1;
  color:#fff;
  position:sticky;
  top:0;
  z-index:2;
}
tr:nth-child(even) { background: rgba(255,255,255,0.05); }

/* Fixed first column */
.schedule-table-container { overflow-x:auto; position: relative; }
#scheduleTable th:first-child,
#scheduleTable td:first-child {
  position: sticky;
  left:0;
  background:#3a3a50;
  z-index:3;
}
body.light-mode #scheduleTable th:first-child,
body.light-mode #scheduleTable td:first-child {
  background:#ddd;
  color:#333;
}

/* Employee row separation */
.employee-row td { border-top:3px solid #888; }

/* SHIFT COLORS */
.shift-4 { background:#2ecc71; color:#fff; }
.shift-6 { background:#e67e22; color:#fff; }
.shift-8 { background:#f1c40f; color:#000; }
.shift-ot { background:#9b59b6; color:#fff; }

/* VACATION / SICK */
.status-vacation {
  background:#7f8c8d;
  color:#fff;
  font-weight:bold;
  font-style:italic;
}
.status-sick {
  background:#c0392b;
  color:#fff;
  font-weight:bold;
  font-style:italic;
}

/* TAB VISIBILITY â€” FIX */
.tab {
  display:block;
  visibility:hidden;
  opacity:0;
  height:0;
  overflow:hidden;
  transform: translateY(10px);
  transition: opacity 0.25s ease, transform 0.25s ease;
}
.tab.active {
  visibility:visible;
  opacity:1;
  height:auto;
  overflow:visible;
  transform: translateY(0);
}

/* PRINT/PDF */
@media print {
  body { margin:0; }
  .tabs, button { display:none; }
}
</style>
</head>

<body>
<h1 id="weekHeader"></h1>
<button onclick="toggleDarkMode()">Toggle Dark Mode</button>

<div class="tabs">
  <button id="tabEmpBtn" onclick="showTab('employeesTab')">Employees</button>
  <button id="tabEvBtn" onclick="showTab('eventsTab')">Events</button>
  <button id="tabSchBtn" onclick="showTab('scheduleTab')">Schedule</button>
  <button onclick="window.print()">Export PDF</button>
</div>

<!-- EMPLOYEES -->
<div id="employeesTab" class="tab">
  <h2>Employees</h2>
  <input id="empName" placeholder="Name" />
  <select id="empType"><option value="FT">FT</option><option value="PT">PT</option></select>
  <input id="empSeniority" type="number" placeholder="Seniority (1=highest)" />
  <input id="empPrefTime" type="time" />
  <button onclick="addEmployee()">Add Employee</button>

  <table>
    <thead>
      <tr><th>Name</th><th>Type</th><th>Seniority</th><th>Pref Start</th><th>Vacation</th><th>Sick</th></tr>
    </thead>
    <tbody id="employeesTable"></tbody>
  </table>
</div>

<!-- EVENTS -->
<div id="eventsTab" class="tab">
  <h2>Events (Manager Only)</h2>
  <input id="eventName" placeholder="Event Name" />
  <input id="eventDate" type="date" />
  <input id="eventGuests" type="number" placeholder="Guests" />
  <input id="eventStaffNeeded" type="number" placeholder="Staff Needed" />
  <input id="eventHours" type="number" step="0.5" placeholder="Event Hours" />
  <button onclick="addEvent()">Add Event</button>

  <table>
    <thead>
      <tr><th>Name</th><th>Date</th><th>Guests</th><th>Staff Needed</th><th>Hours</th></tr>
    </thead>
    <tbody id="eventsTable"></tbody>
  </table>
</div>

<!-- SCHEDULE -->
<div id="scheduleTab" class="tab">
  <h2>Schedule</h2>
  <button onclick="generateSchedule()">Generate Schedule</button>
  <div class="schedule-table-container">
    <table id="scheduleTable"></table>
  </div>
</div>

<script>
let employees = JSON.parse(localStorage.getItem("employees") || "[]");
let events = JSON.parse(localStorage.getItem("events") || "[]");

function saveData(){
  localStorage.setItem("employees", JSON.stringify(employees));
  localStorage.setItem("events", JSON.stringify(events));
}

/* FIXED TAB LOGIC */
function showTab(id){
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));

  document.getElementById(id).classList.add("active");

  if(id==="employeesTab") tabEmpBtn.classList.add("active");
  if(id==="eventsTab") tabEvBtn.classList.add("active");
  if(id==="scheduleTab") tabSchBtn.classList.add("active");
}

/* EMPLOYEES */
function addEmployee(){
  const name=empName.value.trim();
  const type=empType.value;
  const seniority=Number(empSeniority.value);
  const prefStart=empPrefTime.value;
  if(!name||!seniority) return alert("Enter name and seniority");
  employees.push({name,type,seniority,prefStart,vacation:false,sick:false});
  saveData(); renderEmployees();
  empName.value=""; empSeniority.value=""; empPrefTime.value="";
}
function renderEmployees(){
  employeesTable.innerHTML="";
  employees.sort((a,b)=>a.seniority-b.seniority).forEach((e,i)=>{
    employeesTable.innerHTML+=`
      <tr class="employee-row">
        <td>${e.name}</td><td>${e.type}</td><td>${e.seniority}</td>
        <td>${e.prefStart||"-"}</td>
        <td><input type="checkbox" ${e.vacation?"checked":""}
          onchange="employees[${i}].vacation=this.checked;saveData()"></td>
        <td><input type="checkbox" ${e.sick?"checked":""}
          onchange="employees[${i}].sick=this.checked;saveData()"></td>
      </tr>`;
  });
}

/* EVENTS */
function addEvent(){
  const name=eventName.value.trim();
  const date=eventDate.value;
  const guests=Number(eventGuests.value);
  const staffNeeded=Number(eventStaffNeeded.value);
  const hours=Number(eventHours.value);
  if(!name||!date||!guests||!staffNeeded||!hours) return alert("Fill all fields");
  events.push({name,date,guests,staffNeeded,hours});
  saveData(); renderEvents();
  eventName.value=""; eventDate.value=""; eventGuests.value="";
  eventStaffNeeded.value=""; eventHours.value="";
}
function renderEvents(){
  eventsTable.innerHTML="";
  events.forEach(ev=>{
    eventsTable.innerHTML+=`
      <tr><td>${ev.name}</td><td>${ev.date}</td>
      <td>${ev.guests}</td><td>${ev.staffNeeded}</td><td>${ev.hours}</td></tr>`;
  });
}

/* PREF */
function filterByPreference(emp,h){
  if(!emp.prefStart) return true;
  return h>=Number(emp.prefStart.split(":")[0]);
}

/* SCHEDULE */
function getWeekStart(d=new Date()){
  d=new Date(d); const day=d.getDay()||7;
  if(day!==1) d.setDate(d.getDate()-day+1); return d;
}
function formatDateISO(d){ return d.toISOString().split("T")[0]; }
function getWeekDays(){
  const s=getWeekStart(), days=[];
  for(let i=0;i<7;i++){ const d=new Date(s); d.setDate(s.getDate()+i); days.push(d);}
  return days;
}

function generateSchedule(){
  scheduleTable.innerHTML="";
  const days=getWeekDays();
  weekHeader.innerText=days[0].toLocaleString('default',{month:'long',year:'numeric'});
  scheduleTable.innerHTML="<tr><th>Employee</th>"+days.map(d=>`<th>${d.toLocaleDateString(undefined,{weekday:'short',day:'numeric'})}</th>`).join("")+"</tr>";

  [...employees].sort((a,b)=>a.seniority-b.seniority).forEach(emp=>{
    let row=`<tr class="employee-row"><td>${emp.name}</td>`;
    days.forEach(d=>{
      const iso=formatDateISO(d);
      if(emp.vacation) return row+=`<td class="status-vacation">Vacation</td>`;
      if(emp.sick) return row+=`<td class="status-sick">Sick</td>`;
      const ev=events.find(e=>e.date===iso);
      if(!ev||emp.assigned) return row+="<td></td>";
      if(!filterByPreference(emp,ev.hours)) return row+="<td></td>";
      let h=Math.max(4,ev.hours); emp.assigned=true;
      const cls=h<=4?'shift-4':h<=6?'shift-6':h<=8.5?'shift-8':'shift-ot';
      row+=`<td class="${cls}" title="${ev.name}">${h}h</td>`;
    });
    delete emp.assigned;
    scheduleTable.innerHTML+=row+"</tr>";
  });
}

/* DARK MODE */
function toggleDarkMode(){
  document.body.classList.toggle("dark-mode");
  document.body.classList.toggle("light-mode");
}

/* INIT */
renderEmployees();
renderEvents();
showTab("employeesTab");
generateSchedule();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Seniority Scheduler Dashboard</title>

<style>
body {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  margin: 20px;
  background: #1e1e2f;
  color: #f0f0f0;
}
body.light-mode { background:#f8f9fa; color:#333; }

h1 { font-size:26px; }

/* TABS */
.tabs { display:flex; gap:6px; margin-bottom:12px; }
.tabs button {
  padding:8px 14px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  background:#2e2e3d;
  color:#ccc;
}
.tabs button.active { background:#4e9af1; color:#fff; }

/* INPUTS */
input, select, button {
  margin:4px;
  padding:6px 10px;
  border-radius:6px;
  border:none;
}
button { background:#4e9af1; color:#fff; font-weight:bold; }
button.delete { background:#c0392b; }
button.retire { background:#8e44ad; }

/* TABLE */
table { border-collapse:collapse; width:100%; margin-top:10px; }
th, td {
  padding:8px;
  text-align:center;
  border-right:2px solid #555;
  border-bottom:2px solid #444;
}
th:first-child, td:first-child {
  border-right:4px solid #888;
  font-weight:bold;
}
th:last-child, td:last-child { border-right:none; }
th { background:#4e9af1; color:#fff; }

/* STATUS */
.status-vacation { background:#7f8c8d; }
.status-sick { background:#c0392b; }
.status-retired { background:#555; opacity:0.6; }

/* SHIFTS */
.shift-4 { background:#2ecc71; }
.shift-6 { background:#e67e22; }
.shift-65 { background:#f1c40f; color:#000; }
.shift-85 { background:#9b59b6; }

/* CONFLICT */
.conflict {
  background: #e74c3c !important;
  color: #fff;
  font-weight: bold;
  cursor: help;
}

/* TABS */
.tab { display:none; }
.tab.active { display:block; }
</style>
</head>

<body>

<h1 id="weekHeader"></h1>
<button onclick="toggleDarkMode()">Toggle Dark Mode</button>

<div class="tabs">
  <button id="tabEmpBtn" onclick="showTab('employeesTab')">Employees</button>
  <button id="tabEvBtn" onclick="showTab('eventsTab')">Events</button>
  <button id="tabSchBtn" onclick="showTab('scheduleTab')">Schedule</button>
</div>

<!-- EMPLOYEES -->
<div id="employeesTab" class="tab">
<h2>Employees</h2>

<input id="empName" placeholder="Name" />
<select id="empType"><option>FT</option><option>PT</option></select>
<input id="empSeniority" type="number" placeholder="Seniority" />
<select id="empPref">
  <option value="">No Pref</option>
  <option value="AM">AM</option>
  <option value="PM">PM</option>
</select>
<button onclick="addEmployee()">Add</button>

<table>
<thead>
<tr>
  <th>Name</th><th>Type</th><th>Seniority</th><th>Pref</th>
  <th>Vacation</th><th>Sick</th><th>Retire</th>
</tr>
</thead>
<tbody id="employeesTable"></tbody>
</table>
</div>

<!-- EVENTS -->
<div id="eventsTab" class="tab">
<h2>Events</h2>

<input id="eventName" placeholder="Event Name" />
<input id="eventDate" type="date" />
<input id="eventStart" type="time" />
<input id="eventEnd" type="time" />
<input id="eventGuests" type="number" placeholder="Guests" />
<select id="eventService">
  <option>Plated Service</option>
  <option>Buffet Service</option>
  <option>Reception</option>
  <option>Coffee Break</option>
</select>
<input id="eventStaff" type="number" placeholder="Staff Needed" />
<button onclick="addEvent()">Add / Save</button>

<table>
<thead>
<tr>
  <th>Name</th><th>Date</th><th>Time</th>
  <th>Guests</th><th>Service</th><th>Staff</th>
  <th>Edit</th><th>Delete</th>
</tr>
</thead>
<tbody id="eventsTable"></tbody>
</table>
</div>

<!-- SCHEDULE -->
<div id="scheduleTab" class="tab">
<h2>Schedule</h2>

<button onclick="changeWeek(-1)">⬅ Previous Week</button>
<button onclick="changeWeek(1)">Next Week ➡</button>
<button onclick="generateSchedule()">Generate</button>
<button onclick="regenerateSchedule()">Regenerate</button>

<table id="scheduleTable"></table>
</div>

<script>
const PRO_ENABLED = true;

let employees = JSON.parse(localStorage.getItem("employees") || "[]");
let events = JSON.parse(localStorage.getItem("events") || "[]");
let editingEventId = null;
let currentWeekOffset = 0;

/* SAVE */
function save(){
  localStorage.setItem("employees", JSON.stringify(employees));
  localStorage.setItem("events", JSON.stringify(events));
}

/* TABS */
function showTab(id){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(id==="employeesTab") tabEmpBtn.classList.add("active");
  if(id==="eventsTab") tabEvBtn.classList.add("active");
  if(id==="scheduleTab") {
    tabSchBtn.classList.add("active");
    generateSchedule();
  }
}

/* EMPLOYEES */
function addEmployee(){
  employees.push({
    id: crypto.randomUUID(),
    name: empName.value,
    type: empType.value,
    seniority:+empSeniority.value,
    pref: empPref.value,
    vacation:false,
    sick:false,
    retired:false
  });
  rebalanceSeniority();
  save(); renderEmployees(); generateSchedule();
}

function rebalanceSeniority(){
  employees.filter(e=>!e.retired)
    .sort((a,b)=>a.seniority-b.seniority)
    .forEach((e,i)=>e.seniority=i+1);
}

function retireEmployee(id){
  if(!confirm("Retire this employee?")) return;
  const emp = employees.find(e=>e.id===id);
  emp.retired = true;
  rebalanceSeniority();
  save(); renderEmployees(); generateSchedule();
}

function renderEmployees(){
  employeesTable.innerHTML="";
  employees.sort((a,b)=>a.seniority-b.seniority).forEach((e,i)=>{
    employeesTable.innerHTML+=`
    <tr class="${e.retired?'status-retired':''}">
      <td>${e.name}</td>
      <td>${e.type}</td>
      <td>${e.retired?'-':e.seniority}</td>
      <td>${e.pref||"-"}</td>
      <td><input type="checkbox" ${e.vacation?"checked":""} ${e.retired?"disabled":""}
        onchange="employees[${i}].vacation=this.checked;save();generateSchedule()"></td>
      <td><input type="checkbox" ${e.sick?"checked":""} ${e.retired?"disabled":""}
        onchange="employees[${i}].sick=this.checked;save();generateSchedule()"></td>
      <td>${e.retired?"—":`<button class="retire" onclick="retireEmployee('${e.id}')">Retire</button>`}</td>
    </tr>`;
  });
}

/* EVENTS (unchanged) */
function addEvent(){
  if(editingEventId){
    Object.assign(events.find(e=>e.id===editingEventId), readEventForm());
    editingEventId=null;
  } else events.push({ id:crypto.randomUUID(), ...readEventForm() });
  save(); renderEvents(); generateSchedule();
}

function readEventForm(){
  return {
    name:eventName.value,
    date:eventDate.value,
    start:eventStart.value,
    end:eventEnd.value,
    guests:+eventGuests.value,
    service:eventService.value,
    staff:+eventStaff.value
  };
}

function renderEvents(){
  eventsTable.innerHTML="";
  events.forEach(ev=>{
    eventsTable.innerHTML+=`
    <tr>
      <td>${ev.name}</td><td>${ev.date}</td>
      <td>${ev.start}–${ev.end}</td>
      <td>${ev.guests}</td><td>${ev.service}</td>
      <td>${ev.staff}</td>
      <td><button onclick="editEvent('${ev.id}')">Edit</button></td>
      <td><button class="delete" onclick="deleteEvent('${ev.id}')">X</button></td>
    </tr>`;
  });
}

/* WEEK + SCHEDULE */
const iso=d=>d.toISOString().split("T")[0];

function getWeekStart(){
  const d=new Date();
  d.setDate(d.getDate()+currentWeekOffset*7);
  const diff=d.getDay()===0?-6:1-d.getDay();
  d.setDate(d.getDate()+diff);
  d.setHours(0,0,0,0);
  return d;
}

function normalizeHours(start,end){
  const diff=(new Date(`1970-01-01T${end}`)-new Date(`1970-01-01T${start}`))/3600000;
  if(diff<=4) return {h:4,cls:"shift-4"};
  if(diff<6) return {h:6,cls:"shift-6"};
  if(diff<8) return {h:6.5,cls:"shift-65"};
  return {h:8.5,cls:"shift-85"};
}

function generateSchedule(){
  scheduleTable.innerHTML="";
  const start=getWeekStart();
  const days=[...Array(7)].map((_,i)=>{const d=new Date(start);d.setDate(start.getDate()+i);return d;});

  weekHeader.textContent =
    `${days[0].toLocaleDateString()} – ${days[6].toLocaleDateString()}`;

  scheduleTable.innerHTML =
    "<tr><th>Employee</th>" +
    days.map(d=>`<th>${d.toLocaleDateString(undefined,{weekday:"short",day:"numeric"})}</th>`).join("") +
    "<th>Total</th></tr>";

  employees.filter(e=>!e.retired).forEach(emp=>{
    let total=0;
    let row=`<tr><td>${emp.name}</td>`;

    days.forEach(d=>{
      let conflicts=[];
      const ev=events.find(e=>e.date===iso(d));

      if(emp.vacation) conflicts.push("Employee on vacation");
      if(emp.sick) conflicts.push("Employee is sick");

      if(!ev){
        row+="<td></td>";
        return;
      }

      const startHour=parseInt(ev.start);
      if(emp.pref==="AM" && startHour>=12) conflicts.push("PM shift conflicts with AM preference");
      if(emp.pref==="PM" && startHour<12) conflicts.push("AM shift conflicts with PM preference");

      if(conflicts.length){
        row+=`<td class="conflict" title="${conflicts.join(" | ")}">⚠️</td>`;
        return;
      }

      const s=normalizeHours(ev.start,ev.end);
      total+=s.h;
      row+=`<td class="${s.cls}">${s.h}h</td>`;
    });

    let totalCell = total>40
      ? `<td class="conflict" title="Weekly hours exceed 40">${total}h ⚠️</td>`
      : `<td><strong>${total}h</strong></td>`;

    row+=totalCell+"</tr>";
    scheduleTable.innerHTML+=row;
  });
}

function regenerateSchedule(){
  scheduleTable.innerHTML="";
  setTimeout(generateSchedule,50);
}

function toggleDarkMode(){
  document.body.classList.toggle("light-mode");
}

/* INIT */
renderEmployees();
renderEvents();
showTab("employeesTab");
generateSchedule();
</script>
</body>
</html>

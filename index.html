<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Seniority Scheduler Dashboard</title>

<style>
:root {
  --bg:#1e1e2f;
  --panel:#2a2a40;
  --accent:#4e9af1;
  --text:#f0f0f0;
  --muted:#999;
}
body.light {
  --bg:#f4f6f8;
  --panel:#ffffff;
  --accent:#007bff;
  --text:#222;
  --muted:#666;
}

body {
  background:var(--bg);
  color:var(--text);
  font-family:Segoe UI, sans-serif;
  margin:20px;
}

h1,h2 { margin:10px 0; }

.tabs { display:flex; gap:8px; margin-bottom:12px; }
.tabs button {
  padding:8px 14px;
  border:none;
  border-radius:8px;
  background:var(--panel);
  color:var(--text);
  cursor:pointer;
  font-weight:bold;
}
.tabs button.active {
  background:var(--accent);
  color:white;
}

button {
  padding:6px 12px;
  border:none;
  border-radius:6px;
  background:var(--accent);
  color:white;
  cursor:pointer;
}
input, select {
  padding:6px;
  border-radius:6px;
  border:none;
  margin-right:6px;
}

table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th, td {
  padding:8px;
  text-align:center;
  border-bottom:1px solid #444;
}
th { background:var(--accent); color:white; }

.tab { display:none; }
.tab.active { display:block; }

.shift-4 { background:#2ecc71; color:white; }
.shift-6 { background:#e67e22; color:white; }
.shift-65 { background:#f1c40f; color:black; }
.shift-85 { background:#9b59b6; color:white; }

.status-sick { background:#c0392b; color:white; font-weight:bold; }
.status-vacation { background:#7f8c8d; color:white; font-weight:bold; }

</style>
</head>

<body>
<h1 id="weekHeader"></h1>
<button onclick="toggleTheme()">Toggle Dark Mode</button>

<div class="tabs">
  <button id="empTabBtn" onclick="showTab('employees')">Employees</button>
  <button id="eventTabBtn" onclick="showTab('events')">Events</button>
  <button id="schedTabBtn" onclick="showTab('schedule')">Schedule</button>
  <button onclick="window.print()">Export PDF</button>
</div>

<!-- EMPLOYEES -->
<div id="employees" class="tab">
<h2>Employees</h2>
<input id="empName" placeholder="Name">
<select id="empType">
  <option>FT</option><option>PT</option>
</select>
<input id="empSeniority" type="number" placeholder="Seniority">
<select id="empPref">
  <option value="">No Pref</option>
  <option value="AM">AM</option>
  <option value="PM">PM</option>
</select>
<button onclick="addEmployee()">Add</button>

<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Seniority</th><th>Pref</th><th>Vacation</th><th>Sick</th></tr>
</thead>
<tbody id="empTable"></tbody>
</table>
</div>

<!-- EVENTS -->
<div id="events" class="tab">
<h2>Events (Manager)</h2>
<input id="evName" placeholder="Event Name">
<input id="evDate" type="date">
<input id="evStart" type="time">
<input id="evEnd" type="time">
<input id="evGuests" type="number" placeholder="Guests">
<select id="evService">
  <option>Plated</option>
  <option>Buffet</option>
  <option>Reception</option>
  <option>Coffee Break</option>
</select>
<input id="evStaff" type="number" placeholder="Staff Needed">
<button onclick="addEvent()">Add</button>

<table>
<thead>
<tr><th>Name</th><th>Date</th><th>Time</th><th>Guests</th><th>Service</th><th>Staff</th><th>Delete</th></tr>
</thead>
<tbody id="eventTable"></tbody>
</table>
</div>

<!-- SCHEDULE -->
<div id="schedule" class="tab">
<h2>Schedule</h2>
<button onclick="generateSchedule()">Generate</button>
<table id="scheduleTable"></table>
</div>

<script>
let employees = JSON.parse(localStorage.getItem("emps")||"[]");
let events = JSON.parse(localStorage.getItem("events")||"[]");

function save(){
  localStorage.setItem("emps",JSON.stringify(employees));
  localStorage.setItem("events",JSON.stringify(events));
}

/* TABS */
function showTab(id){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* EMPLOYEES */
function addEmployee(){
  if(!empName.value || !empSeniority.value) return;
  employees.push({
    name:empName.value,
    type:empType.value,
    seniority:+empSeniority.value,
    pref:empPref.value,
    vacation:false,
    sick:false
  });
  save(); renderEmployees();
  empName.value=""; empSeniority.value="";
}

function renderEmployees(){
  empTable.innerHTML="";
  employees.sort((a,b)=>a.seniority-b.seniority).forEach((e,i)=>{
    empTable.innerHTML+=`
    <tr>
      <td>${e.name}</td>
      <td>${e.type}</td>
      <td>${e.seniority}</td>
      <td>${e.pref||"-"}</td>
      <td><input type="checkbox" ${e.vacation?"checked":""}
        onchange="employees[${i}].vacation=this.checked;save()"></td>
      <td><input type="checkbox" ${e.sick?"checked":""}
        onchange="employees[${i}].sick=this.checked;save()"></td>
    </tr>`;
  });
}

/* EVENTS */
function addEvent(){
  if(!evName.value||!evDate.value||!evStart.value||!evEnd.value) return;
  events.push({
    name:evName.value,
    date:evDate.value,
    start:evStart.value,
    end:evEnd.value,
    guests:+evGuests.value||0,
    service:evService.value,
    staff:+evStaff.value||0
  });
  save(); renderEvents();
}

function renderEvents(){
  eventTable.innerHTML="";
  events.forEach((e,i)=>{
    eventTable.innerHTML+=`
    <tr>
      <td>${e.name}</td>
      <td>${e.date}</td>
      <td>${e.start}â€“${e.end}</td>
      <td>${e.guests}</td>
      <td>${e.service}</td>
      <td>${e.staff}</td>
      <td><button onclick="delEvent(${i})">X</button></td>
    </tr>`;
  });
}
function delEvent(i){ events.splice(i,1); save(); renderEvents(); }

/* SHIFT NORMALIZATION (FIXED BUG) */
function normalizeShift(hours){
  if(hours <= 4) return {h:4, cls:"shift-4", label:"4h"};
  if(hours < 6) return {h:6, cls:"shift-6", label:"6h"};
  if(hours < 8) return {h:6.5, cls:"shift-65", label:"6.5h"};
  return {h:8.5, cls:"shift-85", label:"8.5h"};
}

/* SCHEDULE */
function generateSchedule(){
  scheduleTable.innerHTML="";
  const days=[...new Set(events.map(e=>e.date))];
  scheduleTable.innerHTML="<tr><th>Employee</th>"+days.map(d=>`<th>${d}</th>`).join("")+"<th>Total</th></tr>";

  employees.forEach(emp=>{
    let total=0;
    let row=`<tr><td>${emp.name}</td>`;

    days.forEach(d=>{
      if(emp.vacation) return row+=`<td class="status-vacation">Vacation</td>`;
      if(emp.sick) return row+=`<td class="status-sick">Sick</td>`;

      const ev=events.find(e=>e.date===d);
      if(!ev) return row+="<td></td>";

      const start=parseInt(ev.start);
      if(emp.pref==="AM" && start>=12) return row+="<td></td>";
      if(emp.pref==="PM" && start<12) return row+="<td></td>";

      const diff=(new Date(`1970-01-01T${ev.end}`)-new Date(`1970-01-01T${ev.start}`))/3600000;
      const s=normalizeShift(diff);
      total+=s.h;
      row+=`<td class="${s.cls}" title="${ev.name}">${s.label}</td>`;
    });

    row+=`<td><strong>${total}h</strong></td></tr>`;
    scheduleTable.innerHTML+=row;
  });
}

/* THEME */
function toggleTheme(){
  document.body.classList.toggle("light");
}

/* INIT */
renderEmployees();
renderEvents();
showTab("employees");
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Seniority Scheduler</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f5f5f5;
}

h1, h2 {
  margin-bottom: 10px;
}

section {
  background: white;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 6px;
}

input, select, button {
  padding: 6px;
  margin: 4px 0;
}

button {
  cursor: pointer;
}

table {
  border-collapse: collapse;
  width: 100%;
  table-layout: fixed;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
  font-size: 13px;
}

th {
  background: #eee;
}

.employee-name {
  text-align: left;
  font-weight: bold;
  background: #fafafa;
}

.shift {
  color: #000;
  font-weight: bold;
  border-radius: 4px;
  padding: 4px;
}

.h4 { background: #7CFC9A; }        /* green */
.h5 { background: #B6FCD5; }
.h6 { background: #FFA94D; }        /* orange */
.h7 { background: #FFD36A; }
.h8 { background: #FFF176; }        /* yellow */
.ot { background: #C084FC; color: white; }
.vacation { background: #ccc; color: #333; }

.controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

small {
  color: #666;
}
</style>
</head>

<body>

<h1>Seniority Scheduler</h1>

<section>
  <h2>Employees</h2>
  <input id="empName" placeholder="Name"/>
  <select id="empType">
    <option value="full">Full Time</option>
    <option value="part">Part Time</option>
  </select>
  <select id="empPref">
    <option value="morning">Morning</option>
    <option value="midday">Midday</option>
    <option value="night">Night</option>
  </select>
  <button onclick="addEmployee()">Add Employee</button>
</section>

<section>
  <h2>Events</h2>
  <input type="date" id="eventDate"/>
  <input type="time" id="eventStart"/>
  <input type="time" id="eventEnd"/>
  <input type="number" id="eventGuests" placeholder="Guests"/>
  <button onclick="addEvent()">Add Event</button>
  <div id="eventList"></div>
</section>

<section class="controls">
  <button onclick="generateSchedule()">Generate Schedule</button>
  <button onclick="exportData()">Export Data</button>
  <input type="file" onchange="importData(event)"/>
  <button onclick="exportPDF()">Export PDF</button>
</section>

<section id="scheduleSection">
  <h2 id="weekTitle"></h2>
  <div id="schedule"></div>
</section>

<script>
let employees = JSON.parse(localStorage.getItem("employees") || "[]");
let events = JSON.parse(localStorage.getItem("events") || "[]");
let schedule = {};

function save() {
  localStorage.setItem("employees", JSON.stringify(employees));
  localStorage.setItem("events", JSON.stringify(events));
}

function addEmployee() {
  const name = empName.value.trim();
  if (!name) return;

  employees.push({
    name,
    type: empType.value,
    preference: empPref.value,
    vacation: []
  });

  save();
  empName.value = "";
}

function addEvent() {
  events.push({
    date: eventDate.value,
    start: eventStart.value,
    end: eventEnd.value,
    guests: Number(eventGuests.value)
  });
  save();
  renderEvents();
}

function renderEvents() {
  eventList.innerHTML = "";
  events.forEach((e, i) => {
    const div = document.createElement("div");
    div.innerHTML = `${e.date} ${e.start}-${e.end} (${e.guests} guests)
      <button onclick="events.splice(${i},1); save(); renderEvents()">❌</button>`;
    eventList.appendChild(div);
  });
}

function getWeekDates() {
  const today = new Date();
  const monday = new Date(today);
  monday.setDate(today.getDate() - ((today.getDay()+6)%7));

  return Array.from({length:7}, (_,i)=>{
    const d = new Date(monday);
    d.setDate(monday.getDate()+i);
    return d;
  });
}

function paidHours(start, end) {
  let diff = (end - start) / 3600000;
  if (diff > 4) diff -= 0.5;
  return diff;
}

function colorClass(hours) {
  if (hours > 8) return "ot";
  return "h" + Math.round(hours);
}

function generateSchedule() {
  schedule = {};
  const week = getWeekDates();

  employees.forEach(emp => {
    schedule[emp.name] = {};
    week.forEach(d => schedule[emp.name][d.toDateString()] = null);
  });

  renderSchedule();
}

function renderSchedule() {
  const week = getWeekDates();
  const monthYear = week[0].toLocaleDateString(undefined,{month:"long",year:"numeric"});
  weekTitle.textContent = monthYear;

  let html = "<table><tr><th>Employee</th>";
  week.forEach(d=>{
    html += `<th>${d.toLocaleDateString(undefined,{weekday:"short"})}<br>${d.getDate()}</th>`;
  });
  html += "</tr>";

  employees.forEach(emp=>{
    html += `<tr><td class="employee-name">${emp.name}</td>`;
    week.forEach(d=>{
      const cell = schedule[emp.name][d.toDateString()];
      if (cell === "vacation") {
        html += `<td class="vacation">Vacation</td>`;
      } else if (cell) {
        html += `<td class="shift ${colorClass(cell.hours)}">
          ${cell.time}<br>${cell.hours}h
        </td>`;
      } else {
        html += `<td>—</td>`;
      }
    });
    html += "</tr>";
  });

  html += "</table>";
  schedule.innerHTML = html;
}

function exportData() {
  const data = { employees, events };
  const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "seniority-scheduler-backup.json";
  a.click();
}

function importData(e) {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    const data = JSON.parse(reader.result);
    employees = data.employees || [];
    events = data.events || [];
    save();
    renderEvents();
    generateSchedule();
  };
  reader.readAsText(file);
}

function exportPDF() {
  html2pdf().set({
    margin: 0.5,
    filename: "weekly-schedule.pdf",
    jsPDF: { orientation: "landscape" }
  }).from(document.getElementById("scheduleSection")).save();
}

renderEvents();
generateSchedule();
</script>

</body>
</html>

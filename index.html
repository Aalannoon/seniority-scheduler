<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seniority Scheduler</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #f5f5f5;
}

h1, h2 {
  margin-top: 30px;
}

input, select, button {
  padding: 6px;
  margin: 4px 0;
}

button {
  cursor: pointer;
}

.section {
  background: #fff;
  padding: 15px;
  border-radius: 6px;
  margin-bottom: 20px;
}

table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 15px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
  vertical-align: top;
}

th {
  background: #eee;
}

.employee-row {
  font-weight: bold;
}

/* ðŸŽ¨ COLOR CODING (BASED ON PAID HOURS) */
.shift-4 {
  background: #c8f7c5;
}

.shift-6 {
  background: #ffd59e;
}

.shift-8 {
  background: #fff3a0;
}

.shift-ot {
  background: #d5b3ff;
}
</style>
</head>

<body>

<h1>Seniority Scheduler</h1>

<!-- EMPLOYEES -->
<div class="section">
  <h2>Add Employee</h2>
  <input id="empName" placeholder="Name">
  <select id="empType">
    <option value="full">Full-Time</option>
    <option value="part">Part-Time</option>
  </select>
  <button onclick="addEmployee()">Add Employee</button>

  <ul id="employeeList"></ul>
</div>

<!-- EVENTS -->
<div class="section">
  <h2>Add Event</h2>
  <input type="date" id="eventDate">
  <input type="time" id="eventStart">
  <input type="time" id="eventEnd">
  <input type="number" id="eventGuests" placeholder="Guests">
  <button onclick="addEvent()">Add Event</button>

  <ul id="eventList"></ul>
</div>

<!-- ACTIONS -->
<div class="section">
  <button onclick="generateSchedule()">Generate Schedule</button>
</div>

<!-- SCHEDULE -->
<div class="section">
  <h2 id="scheduleHeader">Weekly Schedule</h2>
  <div id="schedule"></div>
</div>

<script>
let employees = JSON.parse(localStorage.getItem("employees")) || [];
let events = JSON.parse(localStorage.getItem("events")) || [];
let schedule = {};

function saveData() {
  localStorage.setItem("employees", JSON.stringify(employees));
  localStorage.setItem("events", JSON.stringify(events));
}

function addEmployee() {
  const name = empName.value.trim();
  if (!name) return alert("Enter name");

  employees.push({ name, type: empType.value });
  empName.value = "";
  saveData();
  renderEmployees();
}

function renderEmployees() {
  employeeList.innerHTML = "";
  employees.forEach(e => {
    const li = document.createElement("li");
    li.textContent = `${e.name} (${e.type})`;
    employeeList.appendChild(li);
  });
}

function addEvent() {
  if (!eventDate.value || !eventStart.value || !eventEnd.value)
    return alert("Fill all fields");

  events.push({
    date: eventDate.value,
    start: eventStart.value,
    end: eventEnd.value,
    guests: Number(eventGuests.value || 0)
  });

  saveData();
  renderEvents();
}

function renderEvents() {
  eventList.innerHTML = "";
  events.forEach((e, i) => {
    const li = document.createElement("li");
    li.textContent = `${e.date} ${e.start}-${e.end} (${e.guests} guests)`;
    const btn = document.createElement("button");
    btn.textContent = " âŒ";
    btn.onclick = () => {
      events.splice(i, 1);
      saveData();
      renderEvents();
    };
    li.appendChild(btn);
    eventList.appendChild(li);
  });
}

function recommendServers(guests) {
  if (guests <= 50) return 2;
  if (guests <= 150) return 4;
  if (guests <= 300) return 6;
  return 8;
}

function generateSchedule() {
  schedule = {};

  const sortedEmployees = [...employees].sort((a, b) => {
    if (a.type !== b.type) return a.type === "full" ? -1 : 1;
    return 0;
  });

  events.forEach(event => {
    const start = new Date(event.date + "T" + event.start);
    const end = new Date(event.date + "T" + event.end);
    let paidHours = (end - start) / 3600000;

    paidHours = Math.max(paidHours, 4);
    paidHours = Math.min(paidHours, 8);

    const scheduledHours =
      paidHours > 4 ? paidHours + 0.5 : paidHours;

    const needed = recommendServers(event.guests);
    let assigned = 0;

    sortedEmployees.forEach(emp => {
      if (assigned >= needed) return;

      if (!schedule[emp.name]) schedule[emp.name] = {};

      if (!schedule[emp.name][event.date]) {
        schedule[emp.name][event.date] = {
          start: event.start,
          end: event.end,
          paidHours,
          scheduledHours
        };
      } else {
        const existing = schedule[emp.name][event.date];

        existing.start = existing.start < event.start ? existing.start : event.start;
        existing.end = existing.end > event.end ? existing.end : event.end;

        existing.paidHours = Math.min(existing.paidHours + paidHours, 8);
        existing.scheduledHours =
          existing.paidHours > 4
            ? existing.paidHours + 0.5
            : existing.paidHours;
      }

      assigned++;
    });
  });

  renderSchedule();
}

function getShiftClass(paid) {
  if (paid >= 8) return "shift-8";
  if (paid >= 6) return "shift-6";
  return "shift-4";
}

function renderSchedule() {
  const weekDates = getWeekDates();
  const header = new Date(weekDates[0]);

  scheduleHeader.textContent =
    header.toLocaleString("default", { month: "long", year: "numeric" });

  let html = "<table><tr><th>Employee</th>";

  weekDates.forEach(d => {
    const dateObj = new Date(d);
    html += `<th>${dateObj.toLocaleDateString("default", { weekday: "short" })} ${dateObj.getDate()}</th>`;
  });

  html += "</tr>";

  employees.forEach(emp => {
    html += `<tr><td class="employee-row">${emp.name}</td>`;
    weekDates.forEach(d => {
      const s = schedule[emp.name]?.[d];
      if (s) {
        html += `<td class="${getShiftClass(s.paidHours)}">
          ${s.start}â€“${s.end}<br>
          ${s.scheduledHours.toFixed(1)}h
        </td>`;
      } else {
        html += "<td></td>";
      }
    });
    html += "</tr>";
  });

  html += "</table>";
  schedule.innerHTML = html;
}

function getWeekDates() {
  const today = new Date();
  const monday = new Date(today);
  monday.setDate(today.getDate() - ((today.getDay() + 6) % 7));

  return Array.from({ length: 7 }, (_, i) => {
    const d = new Date(monday);
    d.setDate(monday.getDate() + i);
    return d.toISOString().split("T")[0];
  });
}

renderEmployees();
renderEvents();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Seniority Scheduler</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
}

h1, h2 {
  margin-top: 0;
}

section {
  background: white;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 6px;
}

input, select, button {
  padding: 6px;
  margin: 4px 0;
}

button {
  cursor: pointer;
}

table {
  border-collapse: collapse;
  width: 100%;
  table-layout: fixed;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
  font-size: 13px;
}

th {
  background: #eee;
}

.employee-row {
  background: #fafafa;
  font-weight: bold;
}

.shift-4 { background: #6fcf97; }
.shift-6 { background: #f2994a; }
.shift-8 { background: #f2c94c; }
.shift-ot { background: #bb6bd9; color: white; }

.vacation {
  background: #ddd;
  font-style: italic;
}

.sick {
  background: #bdbdbd;
  font-style: italic;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<h1>Seniority Scheduler</h1>

<section>
<h2>Add Employee</h2>
<input id="empName" placeholder="Name">
<select id="empType">
  <option value="full">Full Time</option>
  <option value="part">Part Time</option>
</select>
<select id="empPref">
  <option value="morning">Morning</option>
  <option value="mid">Midday</option>
  <option value="night">Night</option>
</select>
<button onclick="addEmployee()">Add</button>
</section>

<section>
<h2>Add Event (Manager)</h2>
<input type="date" id="eventDate">
<input placeholder="Event Name (manager only)" id="eventName">
<input type="number" id="guestCount" placeholder="Guests">
<input type="number" id="staffNeeded" placeholder="Servers Needed">
<button onclick="addEvent()">Add Event</button>
</section>

<section>
<h2>Generate Schedule</h2>
<button onclick="generateSchedule()">Generate</button>
</section>

<section>
<h2>Weekly Schedule</h2>
<div id="schedule"></div>
</section>

<script>
let employees = JSON.parse(localStorage.getItem("employees")) || [];
let events = JSON.parse(localStorage.getItem("events")) || [];
let schedule = {};

function save() {
  localStorage.setItem("employees", JSON.stringify(employees));
  localStorage.setItem("events", JSON.stringify(events));
}

function addEmployee() {
  employees.push({
    id: Date.now(),
    name: empName.value,
    type: empType.value,
    pref: empPref.value,
    seniority: employees.length + 1,
    retired: false
  });
  save();
  render();
}

function addEvent() {
  events.push({
    id: Date.now(),
    date: eventDate.value,
    name: eventName.value,
    guests: +guestCount.value,
    staff: +staffNeeded.value
  });
  save();
  render();
}

function generateSchedule() {
  schedule = {};
  const week = getWeek();

  week.forEach(day => {
    schedule[day] = [];
    let todaysEvents = events.filter(e => e.date === day);

    let needed = todaysEvents.reduce((a, e) => a + e.staff, 0);
    let available = [...employees]
      .filter(e => !e.retired)
      .sort((a, b) => {
        if (a.type !== b.type) return a.type === "full" ? -1 : 1;
        return a.seniority - b.seniority;
      });

    let used = new Set();

    for (let emp of available) {
      if (used.size >= needed) break;
      used.add(emp.id);

      let hours = 8;
      schedule[day].push({
        empId: emp.id,
        hours
      });
    }
  });

  render();
}

function getWeek() {
  const today = new Date();
  const monday = new Date(today);
  monday.setDate(today.getDate() - today.getDay() + 1);

  return [...Array(7)].map((_, i) => {
    const d = new Date(monday);
    d.setDate(monday.getDate() + i);
    return d.toISOString().slice(0, 10);
  });
}

function render() {
  let week = getWeek();
  let html = `<table><tr><th>Employee</th>`;
  week.forEach(d => html += `<th>${new Date(d).toDateString()}</th>`);
  html += `</tr>`;

  employees.forEach(emp => {
    html += `<tr><td class="employee-row">${emp.name}</td>`;
    week.forEach(day => {
      let shift = schedule[day]?.find(s => s.empId === emp.id);
      if (!shift) {
        html += `<td></td>`;
      } else {
        let cls = shift.hours === 4 ? "shift-4" :
                  shift.hours === 6 ? "shift-6" :
                  shift.hours === 8 ? "shift-8" : "shift-ot";
        html += `<td class="${cls}">${shift.hours} hrs</td>`;
      }
    });
    html += `</tr>`;
  });

  html += `</table>`;
  document.getElementById("schedule").innerHTML = html;
}

render();
</script>

</body>
</html>

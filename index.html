<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seniority Scheduler</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h2 { margin-top: 30px; }
input, select, button { margin: 4px 0; padding: 6px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }

.vacation { background:#ffecec; }
.parttime { background:#f5f5f5; }

.hour-4 { background:#7CFC9A; }      /* green */
.hour-5 { background:#B6F5C2; }
.hour-6 { background:#FFA94D; }      /* orange */
.hour-7 { background:#FFD166; }
.hour-8 { background:#FFF176; }      /* yellow */
.hour-low { background:#8ECDF7; }    /* blue */
.hour-ot { background:#C084FC; color:#fff; } /* purple */

.day-header {
  background:#333; color:#fff; font-weight:bold;
}
</style>
</head>
<body>

<h1>Weekly Seniority Schedule</h1>

<h2>Generate Schedule</h2>
<button onclick="generateSchedule()">Generate</button>

<table>
<thead>
<tr>
<th>Date</th>
<th>Day</th>
<th>Event</th>
<th>Time</th>
<th>Employee</th>
<th>Hours</th>
</tr>
</thead>
<tbody id="scheduleTable"></tbody>
</table>

<script>
let employees = JSON.parse(localStorage.getItem("employees")||"[]");
let events = JSON.parse(localStorage.getItem("events")||"[]");

function hoursBetween(a,b){
  return (new Date("1970-01-01T"+b)-new Date("1970-01-01T"+a))/36e5;
}

function hourClass(h){
  if(h > 8) return "hour-ot";
  if(h < 4) return "hour-low";
  return "hour-"+Math.round(h);
}

function weekday(date){
  return ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date(date).getDay()];
}

function generateSchedule(){
  scheduleTable.innerHTML="";
  let weekly = {};

  // sort events by date then time
  events.sort((a,b)=>{
    if(a.date!==b.date) return a.date.localeCompare(b.date);
    return a.start.localeCompare(b.start);
  });

  events.forEach(ev=>{
    const day = weekday(ev.date);
    if(!weekly[ev.date]) weekly[ev.date]=[];

    let needed = ev.servers;
    const hours = hoursBetween(ev.start, ev.end);

    let pool = employees
      .filter(e=>!e.vacation)
      .sort((a,b)=>a.seniority-b.seniority);

    for(const emp of pool){
      if(needed<=0) break;

      weekly[ev.date].push({
        date: ev.date,
        day,
        event: ev.name,
        time: ev.start+"â€“"+ev.end,
        emp: emp.name,
        hours
      });

      needed--;
    }
  });

  Object.keys(weekly).forEach(date=>{
    weekly[date].forEach(row=>{
      const tr=document.createElement("tr");
      tr.classList.add(hourClass(row.hours));
      tr.innerHTML=`
        <td>${row.date}</td>
        <td>${row.day}</td>
        <td>${row.event}</td>
        <td>${row.time}</td>
        <td>${row.emp}</td>
        <td>${row.hours}</td>
      `;
      scheduleTable.appendChild(tr);
    });
  });
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seniority Scheduler</title>

<style>
body { font-family: Arial, sans-serif; margin:20px; }
h1,h2 { margin-top:30px; }
input, select, button { padding:6px; margin:4px; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #ccc; padding:6px; vertical-align:top; text-align:center; }

.parttime { background:#f3f3f3; }
.vacation { background:#ffecec; }
.warning { background:#ffe0b2; }

.cell { min-height:60px; }
.shift { margin:4px 0; padding:4px; border-radius:4px; font-size:12px; }

.h4 { background:#7cfc9a; }
.h5 { background:#b6f5c2; }
.h6 { background:#ffa94d; }
.h7 { background:#ffd166; }
.h8 { background:#fff176; }
.ot { background:#c084fc; color:#fff; }

.modal {
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,.4);
  align-items:center; justify-content:center;
}
.modal-content {
  background:#fff; padding:20px; width:340px;
}
</style>
</head>

<body>

<h1>Seniority Scheduler</h1>

<!-- EMPLOYEES -->
<h2>Employees</h2>
<input id="empName" placeholder="Name">
<select id="empType">
  <option value="full">Full Time</option>
  <option value="part">Part Time</option>
</select>
<select id="empPref">
  <option>Morning</option>
  <option>Midday</option>
  <option>Night</option>
</select>
<button onclick="addEmployee()">Add</button>

<table>
<thead>
<tr>
<th>Seniority</th><th>Name</th><th>Type</th><th>Preference</th><th>Status</th>
</tr>
</thead>
<tbody id="employeeTable"></tbody>
</table>

<!-- EVENTS -->
<h2>Events</h2>
<input id="eventName" placeholder="Event name">
<input type="date" id="eventDate">
<input type="time" id="eventStart">
<input type="time" id="eventEnd">
<input type="number" id="eventGuests" placeholder="Guests">
<select id="eventType">
  <option value="seated">Seated Dinner</option>
  <option value="buffet">Buffet</option>
  <option value="cocktail">Cocktail</option>
  <option value="wedding">Wedding / Formal</option>
  <option value="conference">Conference</option>
</select>
<input type="number" id="eventServers" placeholder="Servers (override)">
<button onclick="addEvent()">Add Event</button>

<table>
<thead>
<tr>
<th>Date</th><th>Name</th><th>Time</th><th>Guests</th>
<th>Recommended</th><th>Assigned</th><th>Actions</th>
</tr>
</thead>
<tbody id="eventTable"></tbody>
</table>

<!-- SCHEDULE -->
<h2 id="weekHeader">Weekly Schedule</h2>
<button onclick="generateSchedule()">Generate Schedule</button>
<button onclick="exportCSV()">Export CSV</button>

<table id="scheduleGrid">
<thead>
<tr id="dayHeader"></tr>
</thead>
<tbody id="scheduleBody"></tbody>
</table>

<script>
let employees = JSON.parse(localStorage.getItem("employees")||"[]");
let events = JSON.parse(localStorage.getItem("events")||"[]");

const ratios = { seated:20, buffet:30, cocktail:40, wedding:15, conference:25 };

function saveAll(){
  localStorage.setItem("employees",JSON.stringify(employees));
  localStorage.setItem("events",JSON.stringify(events));
}

function reorderSeniority(){
  const full=employees.filter(e=>e.type==="full");
  const part=employees.filter(e=>e.type==="part");
  employees=[...full,...part];
  employees.forEach((e,i)=>e.seniority=i+1);
}

function addEmployee(){
  employees.push({name:empName.value,type:empType.value,pref:empPref.value,vacation:false});
  reorderSeniority(); saveAll(); renderEmployees(); empName.value="";
}

function renderEmployees(){
  employeeTable.innerHTML="";
  employees.forEach(e=>{
    const tr=document.createElement("tr");
    if(e.vacation) tr.classList.add("vacation");
    if(e.type==="part") tr.classList.add("parttime");
    tr.innerHTML=`
      <td>${e.seniority}</td>
      <td>${e.name}</td>
      <td>${e.type}</td>
      <td>${e.pref}</td>
      <td>${e.vacation?"Vacation":"Active"}</td>
    `;
    employeeTable.appendChild(tr);
  });
}

function recommended(guests,type){
  return Math.ceil(guests / ratios[type]);
}

function addEvent(){
  events.push({
    name:eventName.value,
    date:eventDate.value,
    start:eventStart.value,
    end:eventEnd.value,
    guests:+eventGuests.value,
    type:eventType.value,
    servers:+eventServers.value || recommended(eventGuests.value,eventType.value)
  });
  saveAll(); renderEvents();
}

function renderEvents(){
  eventTable.innerHTML="";
  events.forEach((e,i)=>{
    const rec=recommended(e.guests,e.type);
    const tr=document.createElement("tr");
    if(e.servers<rec) tr.classList.add("warning");
    tr.innerHTML=`
      <td>${e.date}</td>
      <td>${e.name}</td>
      <td>${e.start}-${e.end}</td>
      <td>${e.guests}</td>
      <td>${rec}</td>
      <td>${e.servers}</td>
      <td><button onclick="events.splice(${i},1);saveAll();renderEvents()">Delete</button></td>
    `;
    eventTable.appendChild(tr);
  });
}

function hoursBetween(a,b){
  return (new Date("1970-01-01T"+b)-new Date("1970-01-01T"+a))/36e5;
}

function hourClass(h){
  if(h>8) return "ot";
  return "h"+Math.round(h);
}

function getMonday(d){
  const date=new Date(d);
  const day=date.getDay();
  const diff=date.getDate()-(day===0?6:day-1);
  return new Date(date.setDate(diff));
}

function generateSchedule(){
  scheduleBody.innerHTML="";
  dayHeader.innerHTML="<th>Event</th>";

  if(events.length===0) return;

  const monday=getMonday(events[0].date);
  const days=[];

  for(let i=0;i<7;i++){
    const d=new Date(monday);
    d.setDate(monday.getDate()+i);
    days.push(d);
    dayHeader.innerHTML+=`<th>${d.toLocaleDateString("en",{weekday:"short"})} ${d.getDate()}</th>`;
  }

  weekHeader.innerText = monday.toLocaleDateString("en",{month:"long",year:"numeric"});

  events.forEach(ev=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${ev.name}<br>${ev.start}-${ev.end}</td>`;
    days.forEach(d=>{
      const cell=document.createElement("td");
      cell.className="cell";
      if(ev.date===d.toISOString().split("T")[0]){
        const hours=hoursBetween(ev.start,ev.end);
        const pool=employees.filter(e=>!e.vacation).sort((a,b)=>a.seniority-b.seniority);
        for(let i=0;i<ev.servers && i<pool.length;i++){
          const div=document.createElement("div");
          div.className=`shift ${hourClass(hours)}`;
          div.innerText=`${pool[i].name} (${hours}h)`;
          cell.appendChild(div);
        }
      }
      tr.appendChild(cell);
    });
    scheduleBody.appendChild(tr);
  });
}

function exportCSV(){
  let rows=[["Event","Mon","Tue","Wed","Thu","Fri","Sat","Sun"]];
  document.querySelectorAll("#scheduleBody tr").forEach(tr=>{
    rows.push([...tr.children].map(td=>td.innerText.replace(/\n/g," | ")));
  });
  let csv=rows.map(r=>r.join(",")).join("\n");
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="schedule.csv";
  a.click();
}

renderEmployees();
renderEvents();
</script>

</body>
</html>
